{% extends "base.html" %}
{% load crispy_forms_tags %}

{% block content %}
<main>
  <div class="container wow fadeIn">
    <h2 class="my-5 h2 text-center">Checkout form</h2>
    <div class="row">
      <div class="col-md-8 mb-4">
        <div class="card">
          <form method="POST" class="card-body">
            {% csrf_token %}

            <h3>Shipping address</h3>
            <div class='hideable_shipping_form'>
              <div class="md-form mb-5">
                {{ form.street_address }}
                <label for="{{ form.street_address.id_for_label }}">Address</label>
              </div>

              <div class="md-form mb-5">
                {{ form.apartment_address }}
                <label for="{{ form.apartment_address.id_for_label }}">Address 2 (optional)</label>
              </div>

              <div class="row">
                <div class="col-lg-4 col-md-12 mb-4">
                  <label for="shipping_country">Country</label>
                  {{ form.shipping_country }}
                  <div class="invalid-feedback">
                    Please select a valid country.
                  </div>
                </div>
                <div class="col-lg-4 col-md-6 mb-4">
                  <label for="shipping_zip">Zip</label>
                  {{ form.shipping_zip }}
                  <div class="invalid-feedback">
                    Zip code required.
                  </div>
                </div>
              </div>

              <div class="custom-control custom-checkbox">
                {{ form.same_shipping_address }}
                <label  for="{{ form.same_shipping_address.id_for_label }}">
                  Billing address is the same as my shipping address
                </label>
              </div>
              <div class="custom-control custom-checkbox">
                {{ form.save_info }}
                <label for="{{ form.save_info.id_for_label }}">
                  Save this information for next time
                </label>
              </div>
            </div>

            {% if default_shipping_address %}
            <div class="custom-control custom-checkbox">
              <input type="checkbox" class="custom-control-input" name="use_default_shipping" id="use_default_shipping">
              <label class="custom-control-label" for="use_default_shipping">
                Use default shipping address: {{ default_shipping_address.street_address|truncatechars:10 }}
              </label>
            </div>
            {% endif %}

            <hr>

            <h3>Billing address</h3>
            <div class='hideable_billing_form'>
              <div class="row">
                <div class="col-lg-4 col-md-12 mb-4">
                  <label for="billing_country">Country</label>
                  {{ form.billing_country }}
                  <div class="invalid-feedback">
                    Please select a valid country.
                  </div>
                </div>
                <div class="col-lg-4 col-md-6 mb-4">
                  <label for="billing_zip">Zip</label>
                  {{ form.billing_zip }}
                  <div class="invalid-feedback">
                    Zip code required.
                  </div>
                </div>
              </div>
            </div>

            {% if default_billing_address %}
            <div class="custom-control custom-checkbox">
              <input type="checkbox" class="custom-control-input" name="use_default_billing" id="use_default_billing">
              <label class="custom-control-label" for="use_default_billing">
                Use default billing address: {{ default_billing_address.street_address|truncatechars:10 }}
              </label>
            </div>
            {% endif %}

            <hr>

            <h3>Payment option</h3>
            <div class="d-block my-3">
              {{ form.payment_option }}
            </div>

            <hr class="mb-4">
            <button class="btn btn-primary btn-lg btn-block" type="submit">Continue to checkout</button>
          </form>
        </div>
      </div>

      <div class="col-md-4 mb-4">
        {% include "order_snippet.html" %}
      </div>
    </div>
  </div>
</main>
{% endblock content %}

{% block extra_scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
  const hideable_shipping_form = document.querySelector('.hideable_shipping_form');
  const hideable_billing_form = document.querySelector('.hideable_billing_form');
  const use_default_shipping = document.querySelector('#use_default_shipping');
  const use_default_billing = document.querySelector('#use_default_billing');

  if (use_default_shipping) {
    use_default_shipping.addEventListener('change', function() {
      hideable_shipping_form.style.display = this.checked ? 'none' : 'block';
    });
  }

  if (use_default_billing) {
    use_default_billing.addEventListener('change', function() {
      hideable_billing_form.style.display = this.checked ? 'none' : 'block';
    });
  }
});
</script>
{% endblock extra_scripts %}